<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEON SHOP ‚Äî –í–∏—Ç—Ä–∏–Ω–∞</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --bg-gradient: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --glass: #ffffff;
            --text: #1e293b;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg-gradient);
            margin: 0; padding: 20px 10px 40px 10px;
            color: var(--text);
            line-height: 1.5;
        }

        .container { max-width: 450px; margin: 0 auto; }
        
        h2 { 
            text-align: center; 
            color: var(--text); 
            font-weight: 800; 
            font-size: 24px;
            margin-bottom: 25px; 
            letter-spacing: -0.5px;
        }

        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }

        .product-card {
            background: var(--glass);
            border-radius: 24px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            transition: transform 0.2s;
        }

        .product-card:active { transform: scale(0.98); }

        .product-icon { font-size: 48px; margin-bottom: 10px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        
        .product-name { 
            font-weight: 600; 
            font-size: 15px; 
            text-align: center;
            height: 40px; 
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .badge-stock { 
            font-size: 11px; 
            color: #64748b; 
            background: #f1f5f9; 
            padding: 2px 10px; 
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .product-price { 
            font-size: 18px;
            font-weight: 800; 
            color: var(--primary);
            margin-bottom: 15px; 
        }

        /* –£–ª—É—á—à–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º */
        .add-controls { width: 100%; }
        
        .btn-buy {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
        }

        .stepper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8fafc;
            border-radius: 14px;
            padding: 4px;
            border: 1px solid #e2e8f0;
        }

        .btn-step {
            background: white;
            border: 1px solid #e2e8f0;
            width: 32px;
            height: 32px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            color: var(--primary);
        }

        .step-qty { font-weight: 800; font-size: 16px; }

        /* –°–µ–∫—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã */
        .cart-section { 
            background: white; 
            border-radius: 28px; 
            padding: 24px; 
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            position: sticky;
            bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .cart-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 12px 0; 
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
        }

        .total-sum { 
            font-size: 20px; 
            font-weight: 900; 
            text-align: right; 
            margin: 20px 0; 
            color: var(--text);
        }

        .form-block { display: grid; gap: 10px; }
        .form-block input { 
            padding: 14px; 
            border-radius: 12px; 
            border: 1px solid #cbd5e1; 
            font-size: 16px;
        }

        .btn-send {
            background: #22c55e;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 16px;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 14px 0 rgba(34, 197, 94, 0.39);
        }
    </style>
</head>
<body>

<div class="container">
    <h2>üõç NEON SHOP</h2>

    <div id="catalog" class="products-grid">
        <p style="grid-column: 1/-1; text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
    </div>

    <div class="cart-section" id="cart-block" style="display: none;">
        <h3 style="margin: 0 0 15px 0;">üõí –ú–æ–π –∑–∞–∫–∞–∑</h3>
        <div id="cart-items"></div>
        <div class="total-sum" id="total-price">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</div>

        <div class="form-block">
            <input type="text" id="userName" placeholder="–í–∞—à–µ –∏–º—è" required>
            <input type="tel" id="userPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
            <button class="btn-send" id="sendBtn" onclick="sendOrder()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –ó–ê–ö–ê–ó</button>
        </div>
    </div>
</div>

<script>
    // –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    const firebaseConfig = {
        apiKey: "AIzaSyBH0g83qEUERiDBjgMgRnSJ-s2lvpPtkz4",
        authDomain: "vitrina-e0a00.firebaseapp.com",
        databaseURL: "https://vitrina-e0a00-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "vitrina-e0a00",
        storageBucket: "vitrina-e0a00.firebasestorage.app",
        messagingSenderId: "182787477088",
        appId: "1:182787477088:web:35827926e1e885bb0bfd05"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let products = [];
    let cart = [];

    database.ref('skladData/products').on('value', (snapshot) => {
        products = snapshot.val() || [];
        renderCatalog();
    });

    function renderCatalog() {
        const catalog = document.getElementById('catalog');
        const visibleProducts = products.filter(p => {
            const stock = (p.history || []).reduce((s, h) => s + h.qty, 0);
            return p.hidden !== true && stock > 0;
        });

        if (visibleProducts.length === 0) {
            catalog.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">–¢–æ–≤–∞—Ä—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å</p>';
            return;
        }

        catalog.innerHTML = visibleProducts.map(p => {
            const stock = (p.history || []).reduce((s, h) => s + h.qty, 0);
            const inCart = cart.find(item => item.id === p.id);
            
            // –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å"
            // –ï—Å–ª–∏ –µ—Å—Ç—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º [- 1 +]
            const controls = !inCart 
                ? `<button class="btn-buy" onclick="updateQty(${p.id}, 1)">–ö—É–ø–∏—Ç—å</button>`
                : `<div class="stepper">
                    <button class="btn-step" onclick="updateQty(${p.id}, -1)">-</button>
                    <span class="step-qty">${inCart.qty}</span>
                    <button class="btn-step" onclick="updateQty(${p.id}, 1)">+</button>
                   </div>`;

            return `
                <div class="product-card">
                    <div class="product-icon">${p.icon || 'üì¶'}</div>
                    <div class="product-name">${p.name}</div>
                    <div class="badge-stock">–í –Ω–∞–ª–∏—á–∏–∏: ${stock}</div>
                    <div class="product-price">${p.price} ‚ÇΩ</div>
                    <div class="add-controls">${controls}</div>
                </div>
            `;
        }).join('');
    }

    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç, –∏ —É–±–∞–≤–ª—è–µ—Ç
    function updateQty(pId, delta) {
        const product = products.find(p => p.id === pId);
        const stock = (product.history || []).reduce((s, h) => s + h.qty, 0);
        const existing = cart.find(item => item.id === pId);

        if (existing) {
            existing.qty += delta;
            if (existing.qty > stock) existing.qty = stock;
            if (existing.qty <= 0) {
                cart = cart.filter(i => i.id !== pId);
            }
        } else if (delta > 0) {
            cart.push({ id: product.id, name: product.name, price: product.price, qty: 1 });
        }
        
        renderCatalog();
        renderCart();
    }

    function renderCart() {
        const block = document.getElementById('cart-block');
        const list = document.getElementById('cart-items');
        const totalEl = document.getElementById('total-price');

        if (cart.length === 0) {
            block.style.display = 'none';
            return;
        }

        block.style.display = 'block';
        let total = 0;

        list.innerHTML = cart.map(item => {
            total += item.price * item.qty;
            return `
                <div class="cart-item">
                    <span>${item.name} <b>√ó ${item.qty}</b></span>
                    <span>${item.price * item.qty} ‚ÇΩ</span>
                </div>
            `;
        }).join('');

        totalEl.innerText = `–ò—Ç–æ–≥–æ: ${total} ‚ÇΩ`;
    }

    function sendOrder() {
        const name = document.getElementById('userName').value;
        const phone = document.getElementById('userPhone').value;
        
        if (!name) return alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è");

        const btn = document.getElementById('sendBtn');
        btn.disabled = true;
        btn.innerText = "–û–¢–ü–†–ê–í–ö–ê...";

        const order = {
            id: Date.now(),
            clientName: name + (phone ? ` (${phone})` : ""),
            date: new Date().toLocaleString(),
            items: cart.map(i => ({ name: i.name, qty: i.qty }))
        };

        database.ref('skladData/incomingOrders').get().then(snap => {
            let orders = snap.val() || [];
            orders.push(order);
            database.ref('skladData/incomingOrders').set(orders).then(() => {
                alert("‚úÖ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.");
                cart = [];
                document.getElementById('userName').value = '';
                document.getElementById('userPhone').value = '';
                renderCatalog();
                renderCart();
                btn.disabled = false;
                btn.innerText = "–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –ó–ê–ö–ê–ó";
            });
        });
    }
</script>
</body>
</html>
